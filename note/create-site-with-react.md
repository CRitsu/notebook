# 用 React 做一个图片博客

最近被委托做一个图片博客的页面，刚好借此机会实践一下 React。

这里记录一下遇到的问题和解决方法。

# 需求

目标是做一个展示图文的博客网页。

分为项目设计和单独的作品展示两个模块。

项目设计是文章形式，图文介绍项目内容和成果。

单独的作品展示分为手绘作品和 PS&AI 作品两栏，这一类是图片配一句简短的描述的形式。

结构简单，可以做成一个 SPA。

# 开发环境

开发工具使用 VSCode。

主要使用的库大致如下。

React 系列，可能用到 Redux，但是规模较小也可能不用。

Router 文章页面路由。

Lodash 工具集。

Flow.js 类型检查。

Eslint 检查错误用。

# 遇到的问题

**Eslint 初始化问题。**

我首先导入了 Flow.js 写了一个祖宗组件，后来想起来 eslint 还没初始化，于是执行 `eslint --init` 进行初始化，但是屡试屡败。

报错内容定位到 Flow 的一个类型检查使用的语法不通过。

折腾了一宿，最后一气之下复制了原来的项目的一个配置文件进来使用了。

后来经过调查，发现了原因所在。

之前定位的问题没错，就出在 Flow 上了。

先说结果。

初始化 eslint 若选择检查代码，则需要先移除 Flow 的类型检查语法，否则就会报上文提到的检查不通过的错。

由于我每次初始化 eslint 都会选择第三个选项，检查 JS 代码，这样在初始化的过程中会做一次代码 check，这时如果不通过，eslint 初始化会不成功，配置文件不会自动生成。

总结，项目开始的时候就先把 eslint 配置文件初始化好吧。

# 轮播式 Banner

这个图文站有一个需求。

有多个 Banner 需要轮播横行滚动。

这个需求在常规操作 DOM 的页面上挺好实现的，但是 React 从设计上避免我们直接操作 DOM，这让这个需求变得有些不好实现了。

用 Transition 可以做到平滑的移动，但是对于点击事件我们只能操作 State 的数据来控制组件的表示，这对于控制 Banner 轮播来说缺少了一些灵活性。

我们至少要做到间隔一定时间滚动一次 Banner，还要做到点击 Banner 的面包屑可以切换到相应的 Banner。

这里可能要用上动画组件了。

大致考察了几个动画组件，React-motion，Animated，还有一个新出的 React-spring。

决定用 React-Spring 来做这个 Banner 的特效。

第一次尝试我想做出永远从右往左滑动的效果，而不必一次性渲染所有 Banner，每次只需要出现两个 Banner 即可，一个显示，一个隐藏并在一定时间后平滑过渡显示出来。

这个尝试的结果是，第一次平滑过度没有问题，但是第一次之后滑动动画就不再触发了。

原因是第二次渲染的时候只有图片的 URL 发生了变化，其他都没有变化。

在 React 的规则中，只改变背景图片还不至于整个组件重新渲染，所以画面变化的仅有图片，不再有滑动动画。

这个问题让我思考了一天时间，感觉棘手。网上搜索之下也没有类似的问题，或许是方向不对，不应该固定使用两个组件交替显示平滑过度效果。

最终想到的结果是，做出一步妥协，一次性渲染出所有的 Banner，安排好位置，每次平滑过度时将正确的 Banner 过渡到主页上。

这种方式简单直接且有效。

但是一直一个方向平滑进来的方式作为最初的设想，应该是可以实现的，毕竟查询资料看到的 DEMO 中有类似的例子。

这个就做为有时间的时候的一个调查吧。目前为止这个需求得到了满足。

# 我去，已经完成有段时间了

这个图文站已经完成有一段时间了。基本没啥难度。

https://southwang.github.io/

这是结果。
